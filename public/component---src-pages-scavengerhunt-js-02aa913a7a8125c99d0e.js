"use strict";(self.webpackChunki_ups=self.webpackChunki_ups||[]).push([[426],{1098:function(e,t,n){n.r(t),n.d(t,{default:function(){return q}});n(7420);var a=n(7294),r=n(5414),i=n(647),c=n(6115),s=n.n(c),o=n(7867),l=n.n(o);var h,d,u="hcaptcha-api-script-id",p="hcaptchaOnLoad",m=new Promise((function(e,t){h=e,d=t})),v=function(e){if(void 0===e&&(e={}),document.getElementById(u))return m;window.hcaptchaOnLoad=h;var t=e.apihost||"https://js.hcaptcha.com";delete e.apihost;var n=document.createElement("script");n.id=u,n.src=t+"/1/api.js?render=explicit&onload="+p,n.async=!0,n.onerror=function(e){return d("script-error")};var a=function(e){return Object.entries(e).filter((function(e){e[0];var t=e[1];return t||!1===t})).map((function(e){var t=e[0],n=e[1];return encodeURIComponent(t)+"="+encodeURIComponent(n)})).join("&")}(e);return n.src+=""!==a?"&"+a:"",document.head.appendChild(n),m},f=function(e){function t(t){var n;(n=e.call(this,t)||this).renderCaptcha=n.renderCaptcha.bind(s()(n)),n.resetCaptcha=n.resetCaptcha.bind(s()(n)),n.removeCaptcha=n.removeCaptcha.bind(s()(n)),n.isReady=n.isReady.bind(s()(n)),n.loadCaptcha=n.loadCaptcha.bind(s()(n)),n.handleOnLoad=n.handleOnLoad.bind(s()(n)),n.handleSubmit=n.handleSubmit.bind(s()(n)),n.handleExpire=n.handleExpire.bind(s()(n)),n.handleError=n.handleError.bind(s()(n)),n.handleOpen=n.handleOpen.bind(s()(n)),n.handleClose=n.handleClose.bind(s()(n)),n.handleChallengeExpired=n.handleChallengeExpired.bind(s()(n));var r="undefined"!=typeof hcaptcha;return n.ref=a.createRef(),n.apiScriptRequested=!1,n.state={isApiReady:r,isRemoved:!1,elementId:t.id,captchaId:""},n}l()(t,e);var n=t.prototype;return n.componentDidMount=function(){this.state.isApiReady?this.renderCaptcha():this.loadCaptcha()},n.componentWillUnmount=function(){var e=this.state.captchaId;this.isReady()&&(hcaptcha.reset(e),hcaptcha.remove(e))},n.shouldComponentUpdate=function(e,t){return this.state.isApiReady===t.isApiReady&&this.state.isRemoved===t.isRemoved},n.componentDidUpdate=function(e){var t=this;["sitekey","size","theme","tabindex","languageOverride","endpoint"].every((function(n){return e[n]===t.props[n]}))||this.removeCaptcha((function(){t.renderCaptcha()}))},n.loadCaptcha=function(){if(!this.apiScriptRequested){var e=this.props,t=e.apihost,n=e.assethost,a=e.endpoint,r=e.host,i=e.imghost,c=e.languageOverride,s=e.reCaptchaCompat,o=e.reportapi,l=e.sentry,h=e.custom;v({apihost:t,assethost:n,endpoint:a,hl:c,host:r,imghost:i,recaptchacompat:!1===s?"off":null,reportapi:o,sentry:l,custom:h}).then(this.handleOnLoad).catch(this.handleError),this.apiScriptRequested=!0}},n.renderCaptcha=function(e){if(this.state.isApiReady){var t=Object.assign({"open-callback":this.handleOpen,"close-callback":this.handleClose,"error-callback":this.handleError,"chalexpired-callback":this.handleChallengeExpired,"expired-callback":this.handleExpire,callback:this.handleSubmit},this.props,{hl:this.props.hl||this.props.languageOverride,languageOverride:void 0}),n=hcaptcha.render(this.ref.current,t);this.setState({isRemoved:!1,captchaId:n},(function(){e&&e()}))}},n.resetCaptcha=function(){var e=this.state.captchaId;this.isReady()&&hcaptcha.reset(e)},n.removeCaptcha=function(e){var t=this.state.captchaId;this.isReady()&&this.setState({isRemoved:!0},(function(){hcaptcha.remove(t),e&&e()}))},n.handleOnLoad=function(){var e=this;this.setState({isApiReady:!0},(function(){e.renderCaptcha((function(){var t=e.props.onLoad;t&&t()}))}))},n.handleSubmit=function(e){var t=this.props.onVerify,n=this.state,a=n.isRemoved,r=n.captchaId;"undefined"==typeof hcaptcha||a||t(hcaptcha.getResponse(r),hcaptcha.getRespKey(r))},n.handleExpire=function(){var e=this.props.onExpire,t=this.state.captchaId;this.isReady()&&(hcaptcha.reset(t),e&&e())},n.handleError=function(e){var t=this.props.onError,n=this.state.captchaId;this.isReady()&&hcaptcha.reset(n),t&&t(e)},n.isReady=function(){var e=this.state,t=e.isApiReady,n=e.isRemoved;return t&&!n},n.handleOpen=function(){this.isReady()&&this.props.onOpen&&this.props.onOpen()},n.handleClose=function(){this.isReady()&&this.props.onClose&&this.props.onClose()},n.handleChallengeExpired=function(){this.isReady()&&this.props.onChalExpired&&this.props.onChalExpired()},n.execute=function(e){void 0===e&&(e=null);var t=this.state.captchaId;if(this.isReady())return e&&"object"!=typeof e&&(e=null),hcaptcha.execute(t,e)},n.setData=function(e){var t=this.state.captchaId;this.isReady()&&(e&&"object"!=typeof e&&(e=null),hcaptcha.setData(t,e))},n.getResponse=function(){return hcaptcha.getResponse(this.state.captchaId)},n.getRespKey=function(){return hcaptcha.getRespKey(this.state.captchaId)},n.render=function(){var e=this.state.elementId;return a.createElement("div",{ref:this.ref,id:e})},t}(a.Component),g="scavengerHunt-module--error--F+VlT",E="scavengerHunt-module--hint-button--gqhMg",y="scavengerHunt-module--hint-input--3YkW5",b="scavengerHunt-module--hint-title--41bRP",C="scavengerHunt-module--indicator--I-oVR",w="scavengerHunt-module--noError--oGUJE",R="scavengerHunt-module--scavenger-hunt-title--7acVu",S="scavengerHunt-module--update-message--b9wq5",H="scavengerHunt-module--winner-info--Gz+T+",I=n(6236),O=n(1048);const x=new Error("no hunt available"),k=new Error("no hints were found"),N=new Error("no winners were found");async function A(){const{data:e,error:t}=await O.O.from("hunts").select("*").eq("is_available",!0);if(null==e||e.length<1||null==e[0].id)throw x;return e[0].id}async function D(){return A().then((e=>async function(e){const{data:t,error:n}=await O.O.from("hints").select("*").eq("hunt_id",e);return t}(e))).then((e=>{if(null!=e&&e.length<0)throw k;return e})).catch((e=>{throw console.log(e),x}))}async function j(){return A().then((e=>async function(e){const{data:t,error:n}=await O.O.from("winners").select("*").eq("hunt_id",e);return null==t||t.length>0}(e))).then((e=>e)).catch((e=>{throw console.log(e),x}))}async function L(e){return A().then((t=>{!async function(e,t){const{data:n,error:a}=await O.O.from("winners").insert([{hunt_id:e,discord_id:t}])}(t,e)})).catch((e=>{throw console.log(e),N}))}var q=function(){const{0:e,1:t}=(0,a.useState)([]),{0:n,1:c}=(0,a.useState)([]),{0:s,1:o}=(0,a.useState)(0),{0:l,1:h}=(0,a.useState)(""),{0:d,1:u}=(0,a.useState)(!1),{0:p,1:m}=(0,a.useState)(""),{0:v,1:O}=(0,a.useState)(!1),{0:x,1:k}=(0,a.useState)(!1),{0:N,1:A}=(0,a.useState)(!1),{0:q,1:P}=(0,a.useState)(!0),{0:U,1:Y}=(0,a.useState)(""),{0:V,1:_}=(0,a.useState)(null),F=(0,a.useRef)(),{0:z,1:K}=(0,a.useState)(!1);return(0,a.useEffect)((()=>{P(!0),D().then((e=>{var n=[];Object.values(e).map((e=>{n.push(e)})),t(n),Y("")})).catch((e=>{e.message.includes("available")?_("There is no Scavenger Hunt currently available."):_("An error occurred while retrieving the scavenger hunt data. Please contact a member of Comté.")})).finally((()=>{P(!1)}))}),[]),(0,a.useEffect)((()=>{0==s||s<e.length||(P(!0),j().then((e=>{c(e)})).catch((()=>{_("An error occurred while retrieving the scavenger hunt data. Please contact a member of Comté.")})).finally((()=>{P(!1)})))}),[s]),a.createElement(a.Fragment,null,a.createElement(r.q,null,a.createElement("title",null,"Inter-Uni PokéSoc - Scavenger Hunt"),a.createElement("meta",{name:"viewport",content:"width=device-width, initial-scale=1, maximum-scale=1, user-scalable=0"})),a.createElement(i.Z,null,a.createElement("main",{className:"page-content"},a.createElement("h1",{className:["shiny-title",R].join(" ")},"Scavenger Hunt"),q&&a.createElement("div",{className:"scavengerHunt-module--loader--8fNJJ"},a.createElement(I.Z,null)),a.createElement("div",{id:"scavengerHunt-module--centered-content--fXkpf"},e.length>0&&null==V&&!q&&a.createElement(a.Fragment,null,a.createElement("section",{id:"scavengerHunt-module--hint-wrapper--PUuI+"},a.createElement("section",{id:"scavengerHunt-module--indicator-wrapper--nlQoO"},e.map(((e,t)=>a.createElement("div",{className:[t==s?"scavengerHunt-module--current-indicator--mP-DP":"",t<s?"scavengerHunt-module--completed-indicator--h1JmL":"",C].join(" ")})))),s<e.length&&a.createElement(a.Fragment,null,a.createElement("h2",{id:b,className:"medium-title"},"Hint ",s+1),a.createElement("p",{id:"scavengerHunt-module--hint-text--LlMKK"},e[s].hint),a.createElement("input",{id:y,className:d?g:w,value:l,onInput:e=>h(e.target.value)}),a.createElement("a",{id:E,onClick:()=>{u(!1),e[s].answers.includes(l.toLowerCase())?(Y("Correct! The next hint has been revealed to you."),o(s+1),s>=e.length&&Y("Congrats, you've won the Scavenger Hunt! If you were first you can claim the prize!"),h("")):(u(!0),Y("Try again!"))}},"Check Answer"),a.createElement("p",{id:S},U)),!q&&s>=e.length&&a.createElement(a.Fragment,null,a.createElement("h2",{id:b,className:n?"medium-title":["medium-title","shiny-title"].join(" ")},n?"Scavenger Hunt Complete":"Congratulations Winner"),!n&&!N&&a.createElement(a.Fragment,null,a.createElement("p",{className:H},"Amazing! You were first to complete the Scavenger Hunt!"),a.createElement("p",{className:H},"Please enter your Discord username below to confirm your win."),a.createElement("input",{id:y,className:x?g:w,value:p,onInput:e=>m(e.target.value)}),a.createElement("label",{className:"scavengerHunt-module--discord-checkbox-label--Nv83L"},a.createElement("input",{type:"checkbox",className:"scavengerHunt-module--discord-checkbox--0zGVV",onChange:e=>O(e)}),"I agree to have my Discord username stored and published on this website"),a.createElement("div",{className:"scavengerHunt-module--captcha--mpE0a"},a.createElement(f,{ref:F,sitekey:"56ee2c1d-d19a-4d66-a1a5-ca6f4b57998f",theme:"light",onVerify:()=>K(!0)})),a.createElement("a",{id:E,onClick:()=>{if(k(!1),null==p||!p.match(/^\w+#\d{4}$/g))return k(!0),void Y("Your Discord username is not valid.");v?z?(P(!0),L(p).then((()=>{A(!0),Y("Discord ID: "+p+" uploaded!")})).catch((()=>{Y("An error occurred while processing your Discord username.")})).finally((()=>{P(!1)}))):Y("You need to verify using the captcha."):Y("You need to agree to the storage and publication of your Discord username to continue.")}},"Submit"),a.createElement("p",{id:S},U)),n&&!N&&a.createElement("p",{className:H},"You have completed the Scavenger Hunt. You may have not been first this time, but there'll be another hunt soon!"),N&&a.createElement("p",{className:H},"Your winner data has been added ",p,"! Now go and boast about it on the Discord server :)."))))),a.createElement("section",{className:"page-section"},a.createElement("p",{id:"error-message",className:"scavengerHunt-module--error-message--t2+A2"},null!=V?V:"")))))}}}]);
//# sourceMappingURL=component---src-pages-scavengerhunt-js-02aa913a7a8125c99d0e.js.map